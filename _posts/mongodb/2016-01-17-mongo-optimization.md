---
layout: post
title: "Mongodb设计与优化"
description: "Mongodb设计与优化"
category: "mongodb"
tags: [mongodb]
---
>多看优秀的代码，参与开源项目才能更快的提升自己！

# 一.应用程序设计
在关系型数据库中特别强调的是**范式**, 之前看慕课网《数据库设计那些事》教学视频，总结了一篇文章[**数据库设计小结**](http://beginman.cn/mysql/2015/05/30/db-desigin/)来说明关系型数据库设计步骤与规范。奈何没有这个学习和实践的环境，导致现在我的mysql技能还是马马虎虎的，想想都头疼。

在mongodb中也有范式与反范式，一般就是**内嵌数据和引用数据**的比较，其指导原则如下：

更适合内嵌 | 更适合引用
----|-----
子文档较小 | 子文档较大
数据变动少|数据变动多
最终数据一致即可|中间阶段的数据必须一致
文档数据小幅度增加|文档数据大幅度增加
快速读取|快速写入

>关于引用，则一个集合中包含对其他集合的引用数量叫**基数(cardinality)**,如一对一，一对多，多对多，但是只要确定这多与少的关系，就容易在内嵌和引用之前权衡，如“少”则内嵌，无需引用，“多”则引用。

对于删除旧数据的设计，如特定时间删除数据，常用的设计方案有：

1. 固定集合： 设定集合大小，当集合fulled则旧数据挤出，但在大量插入会降低数据在固定集合内的存活期
2. TTL集合： 对于大量写入则不够快，因为它遍历TTL索引来删除文档
3. 指定多个集合： 如月集合，年集合等设定为临时集合，可能需要一个中间介质如shell脚本，在指定时间后删除该集合。

上述各有利弊，如果针对日志，我建议还是使用固定集合。

**不适合mongodb的场景**

- 不支持事务，如果应用程序对事务有要求则不要使用mongodb
- 对不同数据库连接操作则不要使用mongodb,因为mongo不支持这样跨数据库操作
- 复杂SQL查询的问题不要使用mongodb,最好还是关系型数据库

**适用场景**

- 网站数据：mongo非常适合实时的插入，更新与查询，并具备网站实时数据存储所需的复制及高度伸缩性。
- 缓存：由于性能很高，mongo也适合作为信息基础设施的缓存层。在系统重启之后，由mongo搭建的持久化缓存可以避免下层的数据源过载。
- 大尺寸、低价值的数据：使用传统的关系数据库存储一些数据时可能会比较贵，在此之前，很多程序员往往会选择传统的文件进行存储。
- 高伸缩性的场景：mongo非常适合由数十或者数百台服务器组成的数据库。
- 用于对象及JSON数据的存储：mongo的BSON数据格式非常适合文档格式化的存储及查询。

